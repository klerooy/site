import{_ as w,h as V,k as S,o as U,b as a,c as u,d as e,u as n,y as x,l as i,v as y,g as m,m as g,i as c,t as r,F as _,r as L,f as R,w as M,R as C,p as q,e as k}from"./index-D76P8q1G.js";const N={class:"section"},B={class:"container"},D={key:0,class:"checkout-layout"},h={class:"card form-card"},F={key:0,class:"success"},I={key:1,class:"notice"},T={class:"card summary-card"},E={class:"summary-line"},j={class:"summary-line"},z={class:"summary-line"},A={class:"summary-line total"},G={key:1,class:"card empty"},H={__name:"CheckoutView",setup(J){const o=V(),s=q({full_name:"",phone:"",delivery_method:"courier",payment_method:"card",address:""}),p=k(""),v=k("");S(()=>s.delivery_method,async d=>{await o.setDeliveryMethod(d)});async function b(){p.value="",v.value="";try{const d=await o.checkout({...s});p.value=d.message,v.value=d.order.id,s.full_name="",s.phone="",s.address=""}catch{}}return U(async()=>{await o.fetchCart(),s.delivery_method=o.cart.delivery_method||"courier"}),(d,t)=>{var f;return a(),u("section",N,[e("div",B,[t[22]||(t[22]=e("h1",{class:"title"},"Оформление заказа",-1)),t[23]||(t[23]=e("p",{class:"subtitle"},"Выберите доставку и оплату, заполните данные получателя.",-1)),(f=n(o).cart.detailed_items)!=null&&f.length?(a(),u("div",D,[e("article",h,[t[12]||(t[12]=e("h2",null,"Данные получателя",-1)),e("form",{class:"checkout-form",onSubmit:x(b,["prevent"])},[i(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.full_name=l),class:"input",type:"text",placeholder:"ФИО",required:""},null,512),[[y,s.full_name]]),i(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.phone=l),class:"input",type:"tel",placeholder:"Телефон",required:""},null,512),[[y,s.phone]]),e("label",null,[t[6]||(t[6]=m(" Способ доставки ",-1)),i(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.delivery_method=l),class:"select"},[...t[5]||(t[5]=[e("option",{value:"courier"},"Курьер",-1),e("option",{value:"pickup"},"Самовывоз",-1)])],512),[[g,s.delivery_method]])]),e("label",null,[t[8]||(t[8]=m(" Способ оплаты ",-1)),i(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.payment_method=l),class:"select"},[...t[7]||(t[7]=[e("option",{value:"card"},"Банковская карта",-1),e("option",{value:"sbp"},"СБП",-1),e("option",{value:"cash"},"Наличными",-1)])],512),[[g,s.payment_method]])]),s.delivery_method==="courier"?i((a(),u("textarea",{key:0,"onUpdate:modelValue":t[4]||(t[4]=l=>s.address=l),class:"textarea",rows:"4",placeholder:"Адрес доставки",required:""},null,512)),[[y,s.address]]):c("",!0),t[9]||(t[9]=e("button",{class:"btn btn-primary",type:"submit"},"Подтвердить заказ",-1))],32),p.value?(a(),u("p",F,[m(r(p.value)+" ",1),t[10]||(t[10]=e("br",null,null,-1)),t[11]||(t[11]=m(" Номер: ",-1)),e("strong",null,r(v.value),1)])):c("",!0),n(o).error?(a(),u("p",I,r(n(o).error),1)):c("",!0)]),e("aside",T,[t[17]||(t[17]=e("h2",null,"Сумма к оплате",-1)),(a(!0),u(_,null,L(n(o).cart.detailed_items,l=>(a(),u("div",{class:"summary-line",key:l.product.id},[e("span",null,r(l.product.name)+" × "+r(l.qty),1),e("strong",null,r(l.line_total.toLocaleString("ru-RU"))+" ₽",1)]))),128)),t[18]||(t[18]=e("div",{class:"divider"},null,-1)),e("div",E,[t[13]||(t[13]=e("span",null,"Товары",-1)),e("strong",null,r(n(o).cart.subtotal.toLocaleString("ru-RU"))+" ₽",1)]),e("div",j,[t[14]||(t[14]=e("span",null,"Скидка",-1)),e("strong",null,"-"+r(n(o).cart.discount.toLocaleString("ru-RU"))+" ₽",1)]),e("div",z,[t[15]||(t[15]=e("span",null,"Доставка",-1)),e("strong",null,r(n(o).cart.delivery_cost.toLocaleString("ru-RU"))+" ₽",1)]),e("div",A,[t[16]||(t[16]=e("span",null,"Итого",-1)),e("strong",null,r(n(o).cart.total.toLocaleString("ru-RU"))+" ₽",1)])])])):(a(),u("div",G,[t[20]||(t[20]=e("h3",null,"Нечего оформлять",-1)),t[21]||(t[21]=e("p",null,"Корзина пустая, добавьте товары и вернитесь к оформлению.",-1)),R(n(C),{class:"btn btn-primary",to:"/catalog"},{default:M(()=>[...t[19]||(t[19]=[m("В каталог",-1)])]),_:1})]))])])}}},O=w(H,[["__scopeId","data-v-1efff04c"]]);export{O as default};
